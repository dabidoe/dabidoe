<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Achilles - Character Foundry</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }

        .character-card {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .character-header {
            background: rgba(0, 0, 0, 0.7);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .character-name {
            font-size: 20px;
            font-weight: bold;
            color: #d4af37;
        }

        .stats-line {
            display: flex;
            gap: 12px;
            font-size: 13px;
            margin-top: 4px;
        }

        .hp-display { color: #90ee90; font-weight: bold; }
        .hp-display.damaged { color: #ffa500; }
        .hp-display.critical { color: #ff4444; }
        .ac-display { color: #87ceeb; font-weight: bold; }

        .sheet-btn {
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid #d4af37;
            color: #d4af37;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }

        /* Image Section */
        .image-section {
            flex: 1;
            background: linear-gradient(135deg, #8b4513, #d2691e);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 100px;
        }

        /* Chat Section */
        .chat-section {
            height: 55%;
            background: rgba(0, 0, 0, 0.95);
            border-top: 2px solid #8b4513;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            font-size: 14px;
        }

        .message {
            margin-bottom: 10px;
            padding: 10px 12px;
            border-radius: 12px;
            background: rgba(212, 175, 55, 0.1);
            border-left: 3px solid #d4af37;
            line-height: 1.5;
        }

        .author {
            color: #d4af37;
            font-weight: bold;
            font-size: 11px;
            margin-bottom: 4px;
        }

        .roll-details {
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #90ee90;
            margin: 4px 0;
        }

        /* Condensed Action Buttons - ChatGPT Style */
        .quick-actions {
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.5);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            max-height: 80px;
            overflow-y: auto;
        }

        .action-bubble {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 18px;
            padding: 6px 12px;
            font-size: 12px;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .action-bubble:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(212, 175, 55, 0.6);
            transform: translateY(-1px);
        }

        .action-bubble:active {
            transform: translateY(0);
        }

        /* Mode Tabs */
        .mode-tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.5);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mode-tab {
            flex: 1;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            padding: 10px 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .mode-tab.active {
            color: #d4af37;
            border-bottom-color: #d4af37;
        }

        /* Dice Roller */
        .dice-roller {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #d4af37;
            border-radius: 12px;
            padding: 15px;
            display: none;
            z-index: 1000;
            min-width: 200px;
        }

        .dice-roller.active {
            display: block;
        }

        .dice-roller h4 {
            color: #d4af37;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .dice-inputs {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        .dice-inputs input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 6px;
            border-radius: 6px;
            font-size: 12px;
        }

        .roll-btn {
            width: 100%;
            background: #d4af37;
            border: none;
            color: #000;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
        }

        .close-roller {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
            font-size: 16px;
        }

        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #4a4a62;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="character-card">
        <div class="character-header">
            <div>
                <div class="character-name" id="charName">ACHILLES</div>
                <div class="stats-line">
                    <div class="hp-display" id="hpDisplay">104/104 HP</div>
                    <div class="ac-display" id="acDisplay">AC 18</div>
                </div>
            </div>
            <button class="sheet-btn" onclick="toggleSheet()">üìã Sheet</button>
        </div>

        <div class="image-section">üõ°Ô∏è</div>

        <div class="chat-section">
            <div class="chat-messages" id="chatMessages"></div>

            <div class="quick-actions" id="quickActions"></div>

            <div class="mode-tabs">
                <button class="mode-tab active" data-mode="explore" onclick="setMode('explore')">üó∫Ô∏è Explore</button>
                <button class="mode-tab" data-mode="combat" onclick="setMode('combat')">‚öîÔ∏è Combat</button>
                <button class="mode-tab" data-mode="talk" onclick="setMode('talk')">üí¨ Talk</button>
                <button class="mode-tab" data-mode="dice" onclick="toggleDiceRoller()">üé≤ Dice</button>
            </div>
        </div>
    </div>

    <!-- Dice Roller -->
    <div class="dice-roller" id="diceRoller">
        <button class="close-roller" onclick="toggleDiceRoller()">‚úï</button>
        <h4>üé≤ Dice Roller</h4>
        <div class="dice-inputs">
            <input type="number" id="diceCount" placeholder="Count" value="1" min="1" max="20">
            <input type="number" id="diceSides" placeholder="Sides" value="20" min="2" max="100">
            <input type="number" id="diceModifier" placeholder="+Mod" value="0">
        </div>
        <button class="roll-btn" onclick="customDiceRoll()">Roll</button>
    </div>

    <script>
        // CHARACTER SHEET - Everything references this
        const CHARACTER = {
            name: "Achilles",
            quest: "leading 600,000 souls to freedom from Egyptian bondage",
            location: "the Red Sea crossing",
            hp: { current: 104, max: 104 },
            ac: 18,
            stats: {
                str: 20, dex: 16, con: 18, int: 12, wis: 14, cha: 16
            },
            proficiencyBonus: 4,
            skills: {
                athletics: { mod: 7, proficient: true },
                perception: { mod: 6, proficient: true },
                intimidation: { mod: 7, proficient: true },
                survival: { mod: 6, proficient: true }
            },
            weapons: [
                { name: "Longsword", emoji: "‚öîÔ∏è", toHit: 9, damage: "1d8+6" },
                { name: "Spear", emoji: "üó°Ô∏è", toHit: 10, damage: "1d10+7" }
            ],
            abilities: [
                { name: "Divine Fury", emoji: "üî•", toHit: 8, damage: "2d6+8", type: "spell" },
                { name: "Shield Wall", emoji: "üõ°Ô∏è", type: "defense" },
                { name: "Second Wind", emoji: "üíö", healing: "1d10+10", type: "heal" }
            ]
        };

        let currentMode = 'explore';

        // DICE ROLLING CORE
        function rollDie(sides) {
            return Math.floor(Math.random() * sides) + 1;
        }

        function rollDice(count, sides, modifier = 0) {
            const rolls = [];
            let total = modifier;
            for (let i = 0; i < count; i++) {
                const roll = rollDie(sides);
                rolls.push(roll);
                total += roll;
            }
            return { rolls, total, modifier, formula: `${count}d${sides}${modifier !== 0 ? (modifier > 0 ? '+' : '') + modifier : ''}` };
        }

        function addMessage(text, details = null) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';

            let html = `<div class="author">${CHARACTER.name} üõ°Ô∏è</div><div>${text}</div>`;
            if (details) {
                html += `<div class="roll-details">${details}</div>`;
            }

            messageDiv.innerHTML = html;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // INITIALIZE
        function init() {
            // Dynamic intro based on character
            addMessage(`I am ${CHARACTER.name}, ${CHARACTER.quest}. We stand at ${CHARACTER.location}.`);
            addMessage("What would you have me do?");
            setMode('explore');
        }

        // MODE SYSTEM
        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.mode === mode);
            });
            updateQuickActions();
        }

        function updateQuickActions() {
            const actionsDiv = document.getElementById('quickActions');
            actionsDiv.innerHTML = '';

            if (currentMode === 'explore') {
                addAction('üîç Scout Ahead', () => skillCheck('Perception', CHARACTER.skills.perception));
                addAction('üèïÔ∏è Make Camp', () => addMessage('We rest and tend to our wounds. The journey continues tomorrow.'));
                addAction('üó£Ô∏è Rally Troops', () => skillCheck('Intimidation', CHARACTER.skills.intimidation));
                addAction('üó∫Ô∏è Navigate', () => skillCheck('Survival', CHARACTER.skills.survival));
            } else if (currentMode === 'combat') {
                addAction('üé≤ Initiative', () => initiative());
                CHARACTER.weapons.forEach(weapon => {
                    addAction(`${weapon.emoji} ${weapon.name}`, () => weaponAttack(weapon));
                });
                CHARACTER.abilities.forEach(ability => {
                    if (ability.type === 'spell' || ability.type === 'defense' || ability.type === 'heal') {
                        addAction(`${ability.emoji} ${ability.name}`, () => useAbility(ability));
                    }
                });
            } else if (currentMode === 'talk') {
                addAction('üí≠ About yourself', () => addMessage("I once fought at Troy for glory. Now I fight for something greater‚Äîfreedom for my people."));
                addAction('üó∫Ô∏è The quest', () => addMessage(`Our quest is clear: ${CHARACTER.quest}. Every step defies empires.`));
                addAction('üìñ Tell a story', () => addMessage("At Troy, Patroclus taught me that some causes matter more than fame. I carry that lesson with me."));
                addAction('ü§ù Offer encouragement', () => addMessage("Take heart, friend. We've come this far together. The gods favor the bold!"));
            }
        }

        function addAction(label, onClick) {
            const actionsDiv = document.getElementById('quickActions');
            const bubble = document.createElement('div');
            bubble.className = 'action-bubble';
            bubble.textContent = label;
            bubble.onclick = onClick;
            actionsDiv.appendChild(bubble);
        }

        // COMBAT MECHANICS
        function weaponAttack(weapon) {
            // Roll to hit (d20 + modifier)
            const d20 = rollDie(20);
            const toHit = d20 + weapon.toHit;
            const isCrit = d20 === 20;
            const isFail = d20 === 1;

            let message = `${weapon.emoji} **${weapon.name} Attack**`;
            let details = `To Hit: ${toHit} (d20: ${d20} + ${weapon.toHit})`;

            if (isCrit) {
                message += ' - **CRITICAL HIT!**';
                // Double damage dice on crit
                const [diceCount, rest] = weapon.damage.split('d');
                const [diceSides, modifier] = rest.split('+').map(n => parseInt(n));
                const dmg = rollDice(parseInt(diceCount) * 2, diceSides, modifier);
                details += `\nDamage: ${dmg.total} (${dmg.formula}: [${dmg.rolls.join(', ')}] + ${modifier})`;
                message += '\n\nMy blade strikes true with devastating force!';
            } else if (isFail) {
                message += ' - **CRITICAL MISS**';
                message += '\n\nEven legends stumble...';
            } else {
                // Normal damage
                const [diceCount, rest] = weapon.damage.split('d');
                const [diceSides, modifier] = rest.split('+').map(n => parseInt(n));
                const dmg = rollDice(parseInt(diceCount), diceSides, modifier);
                details += `\nDamage: ${dmg.total} (${dmg.formula}: [${dmg.rolls.join(', ')}] + ${modifier})`;

                if (toHit >= 20) {
                    message += '\n\nA solid strike!';
                }
            }

            addMessage(message, details);
        }

        function useAbility(ability) {
            if (ability.type === 'spell') {
                const d20 = rollDie(20);
                const toHit = d20 + ability.toHit;
                const isCrit = d20 === 20;

                let message = `${ability.emoji} **${ability.name}**`;
                let details = `Attack: ${toHit} (d20: ${d20} + ${ability.toHit})`;

                const [diceCount, rest] = ability.damage.split('d');
                const [diceSides, modifier] = rest.split('+').map(n => parseInt(n));
                const multiplier = isCrit ? 2 : 1;
                const dmg = rollDice(parseInt(diceCount) * multiplier, diceSides, modifier);

                details += `\nDamage: ${dmg.total} (${isCrit ? diceCount * 2 : diceCount}d${diceSides}+${modifier}: [${dmg.rolls.join(', ')}] + ${modifier})`;

                if (isCrit) {
                    message += ' - **CRITICAL HIT!**\n\nDivine power surges through me!';
                } else {
                    message += '\n\nI channel my fury into this strike!';
                }

                addMessage(message, details);
            } else if (ability.type === 'defense') {
                const d20 = rollDie(20);
                addMessage(`${ability.emoji} **${ability.name}**`, `Defense Roll: ${d20 + 5} (d20: ${d20} + 5)\n\nI raise my shield in protection!`);
            } else if (ability.type === 'heal') {
                const [diceCount, rest] = ability.healing.split('d');
                const [diceSides, modifier] = rest.split('+').map(n => parseInt(n));
                const heal = rollDice(parseInt(diceCount), diceSides, modifier);
                addMessage(`${ability.emoji} **${ability.name}**`, `Healing: ${heal.total} HP (${heal.formula}: [${heal.rolls.join(', ')}] + ${modifier})\n\nMy warrior's spirit restores me!`);
                CHARACTER.hp.current = Math.min(CHARACTER.hp.current + heal.total, CHARACTER.hp.max);
                updateHPDisplay();
            }
        }

        function initiative() {
            const dexMod = Math.floor((CHARACTER.stats.dex - 10) / 2);
            const roll = rollDie(20) + dexMod;
            addMessage('üé≤ **Initiative Roll**', `Initiative: ${roll} (d20: ${roll - dexMod} + ${dexMod})\n\nI ready myself for battle!`);
        }

        function skillCheck(skillName, skill) {
            const d20 = rollDie(20);
            const total = d20 + skill.mod;
            const profMarker = skill.proficient ? ' ‚≠ê' : '';

            let message = `üé≤ **${skillName} Check${profMarker}**`;
            let details = `Result: ${total} (d20: ${d20} + ${skill.mod})`;

            if (d20 === 20) {
                message += ' - **NATURAL 20!**\n\nPerfectly executed!';
            } else if (d20 === 1) {
                message += ' - **NATURAL 1**\n\nNot my finest moment...';
            } else if (total >= 20) {
                message += '\n\nWell done!';
            }

            addMessage(message, details);
        }

        // DICE ROLLER
        function toggleDiceRoller() {
            const roller = document.getElementById('diceRoller');
            roller.classList.toggle('active');
        }

        function customDiceRoll() {
            const count = parseInt(document.getElementById('diceCount').value);
            const sides = parseInt(document.getElementById('diceSides').value);
            const modifier = parseInt(document.getElementById('diceModifier').value);

            const result = rollDice(count, sides, modifier);
            addMessage('üé≤ **Custom Roll**', `Result: ${result.total} (${result.formula}: [${result.rolls.join(', ')}]${modifier !== 0 ? ' + ' + modifier : ''})`);
        }

        // CHARACTER SHEET
        function toggleSheet() {
            alert(`CHARACTER SHEET\n\nName: ${CHARACTER.name}\nHP: ${CHARACTER.hp.current}/${CHARACTER.hp.max}\nAC: ${CHARACTER.ac}\n\nSTR: ${CHARACTER.stats.str}\nDEX: ${CHARACTER.stats.dex}\nCON: ${CHARACTER.stats.con}\nINT: ${CHARACTER.stats.int}\nWIS: ${CHARACTER.stats.wis}\nCHA: ${CHARACTER.stats.cha}\n\nProficiency: +${CHARACTER.proficiencyBonus}`);
        }

        function updateHPDisplay() {
            const hpDisplay = document.getElementById('hpDisplay');
            hpDisplay.textContent = `${CHARACTER.hp.current}/${CHARACTER.hp.max} HP`;
            const percent = CHARACTER.hp.current / CHARACTER.hp.max;
            hpDisplay.className = 'hp-display' + (percent <= 0.25 ? ' critical' : percent <= 0.6 ? ' damaged' : '');
        }

        // Start!
        init();
    </script>
</body>
</html>
